# Cohort Review — Tier 1, Harper v5-local (5.0.0-unreleased)

**Date:** 2026-02-09
**Convoy:** hq-cv-qpu5s
**Workers:** 3 (furiosa, nux, slit)
**Image:** harperdb:v5-local (5.0.0-unreleased)
**Expert iteration:** 0

---

## Result: 3/3 PASS

All 3 workers independently completed all pass criteria. Zero expert interventions required across the cohort.

## Workers

| Worker | Polecat | Bead | Harper REST | Duration | Result |
|--------|---------|------|-------------|----------|--------|
| 1 | furiosa | dl-drdt | :19928 | ~9 min | PASS |
| 2 | nux | dl-n10r | :19930 | ~12 min | PASS |
| 3 | slit | dl-d5hv | :19932 | ~13 min | PASS |

## Pass Criteria (all workers)

- [x] Schema deployed successfully to Harper
- [x] Can create a bookmark via REST (`POST /Bookmark/`)
- [x] Can retrieve a bookmark by ID (`GET /Bookmark/{id}`)
- [x] Can list all bookmarks (`GET /Bookmark/`)
- [x] Can update an existing bookmark
- [x] Can delete a bookmark (`DELETE /Bookmark/{id}`)
- [x] Can filter bookmarks by tag (`GET /Bookmark/?tags=value`)
- [x] Can search bookmarks by title partial match (`GET /Bookmark/?title=ct=value`)
- [x] No Express/Fastify — uses Harper's built-in `@export`
- [x] No SQL — uses REST API
- [x] Tags field properly indexed (`@indexed` on `[String]`)

## Cross-Worker Comparison

### Schema Consistency
All 3 workers produced functionally equivalent schemas:
```graphql
type Bookmark @table @export {
  id: ID @primaryKey
  url: String
  title: String @indexed
  description: String
  tags: [String] @indexed
  createdAt: Long @createdTime
}
```
Minor variation: worker naming conventions for fields were identical. All used `@createdTime` for auto-timestamping. Strong convergence.

### Discovery Paths
| Finding | furiosa (W1) | nux (W2) | slit (W3) |
|---------|:---:|:---:|:---:|
| FIQL `=ct=` for partial search | Discovered from docs | Discovered via research subagent | Discovered from docs |
| `config.yaml` needs explicit `rest: true` | Found empirically | Hit component loading error, researched fix | Found empirically |
| Tag filtering via `?tags=value` | Native discovery | Native discovery | Native discovery |
| PATCH strips unlisted fields | Not reported | Not reported | Discovered empirically |

### Time Variance
- **Fastest:** furiosa (~9 min) — direct path, minimal exploration
- **Slowest:** slit (~13 min) — more thorough testing, discovered PATCH behavior
- **Middle:** nux (~12 min) — hit component loading issues, used research subagent

The variance is healthy: different workers explored different edges of the API surface, collectively producing a richer picture than any single worker.

## Key Findings

### 1. Harper v5 config.yaml requires explicit directives (all workers)
- **Classification:** dx_gap
- **Severity:** high
- **Details:** All 3 workers hit this: Harper v5 requires `config.yaml` with explicit `rest: true` and `graphqlSchema: files:` settings. Simply placing a `schema.graphql` in the component directory is insufficient. This was the primary friction point.
- **Consensus:** 3/3 workers encountered this independently. Strong signal this needs documentation.

### 2. FIQL `=ct=` operator not obvious (all workers)
- **Classification:** doc_gap
- **Severity:** medium
- **Details:** Partial title matching requires FIQL `=ct=` (contains) operator. No worker found this immediately — all tried wildcards or SQL LIKE first. Eventually all found the correct syntax from docs or experimentation.
- **Action:** Assignment should hint at FIQL, or Harper docs should surface this more prominently.

### 3. PATCH replaces entire record, doesn't merge (W3 only)
- **Classification:** api_behavior
- **Severity:** medium
- **Details:** Worker 3 (slit) discovered that `PATCH /Bookmark/{id}` with partial fields strips unlisted fields from the record. This is unexpected REST behavior — PATCH should be a partial update. Full record must be sent with PUT.
- **Action:** File as potential Harper bug or document as intended behavior.

### 4. No curl or wget in v5-local image (infrastructure)
- **Classification:** dx_bug
- **Severity:** low
- **Details:** The v5-local (5.0.0-unreleased) image contains neither `curl` nor `wget`. Docker healthcheck and lab-runner wait loop both failed. Fixed by switching healthcheck to `node -e fetch(...)` and wait loop to `curl -so /dev/null` from host.
- **Delta from pilot:** The pilot (4.7.19) had `wget`. The v5 image dropped it.

### 5. Port overlap bug in lab-runner.sh (infrastructure)
- **Classification:** infra_bug
- **Severity:** medium
- **Details:** Original port calculation `BASE + WORKER_ID` caused OPS port of worker N to collide with REST port of worker N-1. Fixed to `BASE + WORKER_ID * 2`.

## Infrastructure Fixes Made

1. **docker-compose.worker.yml:** Image ref changed from `harperdb/harperdb:${HARPER_VERSION}` to `${HARPER_IMAGE}` with `--harper-image` flag support
2. **docker-compose.worker.yml:** Healthcheck changed from `wget` to `node -e fetch(...)` (v5-local has no curl/wget)
3. **docker-compose.worker.yml:** Added `DEFAULTS_MODE=dev` environment variable
4. **lab-runner.sh:** Port spacing fixed from `+ WORKER_ID` to `+ WORKER_ID * 2`
5. **lab-runner.sh:** Wait loop changed from `wget/curl -sf` to `curl -so /dev/null` (accepts 404)
6. **lab-runner.sh:** Added `--harper-image` flag alongside legacy `--harper-version`

## Comparison with Pilot (2026-02-08)

| Metric | Pilot (4.7.19) | Cohort (v5-local) |
|--------|:-:|:-:|
| Workers | 1 | 3 |
| Pass rate | 1/1 (100%) | 3/3 (100%) |
| Avg duration | ~6 min | ~11 min |
| Expert interventions | 0 | 0 |
| HTTPS required | Yes | No (dev mode) |
| curl/wget available | wget only | Neither |

The v5-local image in dev mode (`DEFAULTS_MODE=dev`) serves HTTP, avoiding the HTTPS/self-signed cert friction from the pilot. However, the stripped-down image (no curl/wget) created new infrastructure challenges.

Duration increase (~6 → ~11 min avg) is attributed to v5 config.yaml changes requiring more discovery, not regression in agent capability.

## Recommendations

1. **Tier 1 is graduated.** 4/4 total passes (1 pilot + 3 cohort), zero interventions. Mark as `reliable`.

2. **File Harper issues:**
   - `config.yaml` defaults should include `rest: true` when a schema.graphql exists
   - Document PATCH-as-replace behavior (or fix to merge semantics)
   - FIQL `=ct=` operator needs prominent docs placement

3. **Commit infrastructure fixes upstream.** The port overlap, healthcheck, and `--harper-image` changes should be merged to main.

4. **Proceed to Tier 2** with confidence. Tier 1 baseline is solid on both Harper 4.x and 5.x.

## Artifacts

- Convoy: hq-cv-qpu5s
- Beads: dl-drdt (W1), dl-n10r (W2), dl-d5hv (W3)
- Branches: `polecat/furiosa/dl-drdt@mlfd3s0i`, `polecat/nux/dl-n10r@mlfd46ux`, `polecat/slit/dl-d5hv@mlfd4m3i`
